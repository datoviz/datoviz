<!DOCTYPE html>
<html>

<head>
    <title>Datoviz IBL test</title>

    <!-- CSS styles -->
    <style>
        html {
            background-color: white;
        }
    </style>

    <!-- Visualization client -->
    <script>

        // https://stackoverflow.com/a/27078401/1595060
        function throttle(callback, limit) {
            var waiting = false;                      // Initially, we're not waiting
            return function () {                      // We return a throttled function
                if (!waiting) {                       // If we're not waiting
                    callback.apply(this, arguments);  // Execute users function
                    waiting = true;                   // Prevent future invocations
                    setTimeout(function () {          // After a period of time
                        waiting = false;              // And allow future invocations
                    }, limit);
                }
            }
        }

        const DEFAULT_EID = "41872d7f-75cb-4445-bb1a-132b354c44f0";
        const RAW_URL = "http://localhost:1234/"

        function makeURL(eid, t) {
            return RAW_URL + eid + "/" + t.toFixed(2);
        }

        function goTo(t) {
            t = t * 1.0;
            console.log("Go to " + t + " seconds.");
            img.src = makeURL(DEFAULT_EID, t);
        }

        goToThrottled = throttle(goTo, 500);

        // On load, create the websocket and set the onnopen, onmessage, and onclose callbacks.
        function load() {

            const slider = document.getElementById('time');
            const number = document.getElementById('number');
            const img = document.getElementById('img');

            img.src = makeURL(DEFAULT_EID, 0);

            slider.addEventListener('input', function (e) {
                goToThrottled(e.target.value);
            });

            number.addEventListener('input', function (e) {
                goToThrottled(e.target.value);
            });

        }

    </script>
</head>

<body onload="load();">
    <div style="width: 800px; padding: 0;">
        <img id="img" style="width: 1024px; height: 480px; margin: 0; border: 0px solid #000;" />
        <div>
            <label for="time">Time</label>
            <input type="range" id="time" name="time" min="0" max="60" value="0" step="0.01" style="width: 800px;"
                oninput="this.nextElementSibling.value=this.value">
            <input type="number" id="number" name="number" min="0" max="60" value="0" step="0.01" style="width: 100px;"
                oninput="this.previousElementSibling.value=this.value">
        </div>
    </div>
</body>

</html>
